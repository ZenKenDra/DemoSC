<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DexPro - Base Zero Fee Mode</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Babel untuk JSX Support -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body { background-color: #0b0e14; color: white; -webkit-tap-highlight-color: transparent; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Animasi Loading Awal */
        #root:empty::before {
            content: 'Menghubungkan ke Base...';
            display: flex;
            height: 100vh;
            justify-content: center;
            align-items: center;
            color: #0052ff; /* Base Blue */
            font-family: sans-serif;
            font-size: 0.875rem;
        }

        /* Modal Backdrop */
        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(4px);
        }

        /* Toast Animation */
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        .toast-enter { animation: slideIn 0.3s ease-out forwards; }
        
        /* Pulse Effect */
        .flash-green { color: #4ade80; transition: color 0.3s; }
        .flash-red { color: #f87171; transition: color 0.3s; }
        
        /* Base Gradient Text */
        .text-base-blue { color: #0052ff; }
    </style>

    <!-- IMPORT MAP -->
    <script type="importmap">
    {
        "imports": {
            "react": "https://esm.sh/react@18.2.0",
            "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
            "react-dom": "https://esm.sh/react-dom@18.2.0",
            "recharts": "https://esm.sh/recharts@2.12.7?external=react,react-dom",
            "ethers": "https://esm.sh/ethers@6.11.1"
        }
    }
    </script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useRef } from 'react';
        import { createRoot } from 'react-dom/client';
        import { AreaChart, Area, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer } from 'recharts';
        import { ethers, BrowserProvider, parseEther, formatEther } from 'ethers';

        // --- KONFIGURASI NETWORK: BASE SEPOLIA ---
        const BASE_NETWORK = {
            chainId: '0x14a34', // 84532 Desimal
            chainName: 'Base Sepolia',
            nativeCurrency: { name: 'Ether', symbol: 'ETH', decimals: 18 },
            rpcUrls: ['https://sepolia.base.org'],
            blockExplorerUrls: ['https://sepolia.basescan.org/']
        };

        // --- ICONS ---
        const IconActivity = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>;
        const IconMenu = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg>;
        const IconSettings = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>;
        const IconArrowDownUp = () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m3 16 4 4 4-4"/><path d="M7 20V4"/><path d="m21 8-4-4-4 4"/><path d="M17 4v16"/></svg>;
        const IconChevronDown = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m6 9 6 6 6-6"/></svg>;
        const IconExternalLink = () => <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>;
        const IconRefresh = () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"/><path d="M16 21h5v-5"/></svg>;
        const IconGift = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 12 20 22 4 22 4 12"/><rect x="2" y="7" width="20" height="5"/><line x1="12" y1="22" x2="12" y2="7"/><path d="M12 7H7.5a2.5 2.5 0 0 1 0-5C11 2 12 7 12 7z"/><path d="M12 7h4.5a2.5 2.5 0 0 0 0-5C13 2 12 7 12 7z"/></svg>;
        const IconBolt = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg>;
        
        // --- PHANTOM ICON ---
        const IconPhantom = () => (
            <svg viewBox="0 0 28 24" width="22" height="22" fill="#AB9FF2">
                <path d="M23.2 5.86C21.46 2.27 17.58 0 13.98 0 7.24 0 1.8 5.66 1.8 12.63c0 2.47.69 4.8 1.89 6.8l-1.84 4.09c-.27.6.35 1.19.92.88l3.96-2.18c1.8.87 3.84 1.34 5.96 1.34h.63c7.22 0 12.87-5.18 12.87-12.15 0-2.07-.99-3.95-2.99-5.55zm-11.83 9.4c-1.37 0-2.48-1.11-2.48-2.48s1.11-2.48 2.48-2.48 2.48 1.11 2.48 2.48-1.11 2.48-2.48 2.48zm8.17 0c-1.37 0-2.48-1.11-2.48-2.48s1.11-2.48 2.48-2.48 2.48 1.11 2.48 2.48-1.11 2.48-2.48 2.48z"/>
            </svg>
        );

        const PAIR_ADDRESS = '0x2287a9620adcbf6250dc71be9ee9b2d3a1ec85a464fc6f5c06669e8d07b61bba';
        const API_URL = `https://api.dexscreener.com/latest/dex/pairs/ethereum/${PAIR_ADDRESS}`;

        function App() {
            // State
            const [account, setAccount] = useState('');
            const [provider, setProvider] = useState(null);
            const [isPhantomInstalled, setIsPhantomInstalled] = useState(false);
            
            const [realBalance, setRealBalance] = useState(0);
            const [mockBalance, setMockBalance] = useState(0);
            
            const [networkName, setNetworkName] = useState('');
            const [marketData, setMarketData] = useState({
                priceUsd: 0, priceChange: 0, volume24h: 0, marketCap: 0, pairName: 'ETH/USDC', loading: true
            });
            const [chartData, setChartData] = useState([]);
            const [currentTimeFrame, setCurrentTimeFrame] = useState('1H');
            const [inputToken, setInputToken] = useState('ETH');
            const [outputToken, setOutputToken] = useState('USDC');
            const [inputAmount, setInputAmount] = useState('');
            const [outputAmount, setOutputAmount] = useState('');
            const [priceFlash, setPriceFlash] = useState('');
            const [toasts, setToasts] = useState([]);
            const [isSwapping, setIsSwapping] = useState(false);
            const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);
            const [isFaucetLoading, setIsFaucetLoading] = useState(false);

            const prevPriceRef = useRef(0);
            const lastChartPointRef = useRef(null);

            const totalDisplayBalance = (realBalance + mockBalance).toFixed(4);

            const addToast = (msg, type = 'success') => {
                const id = Date.now();
                setToasts(prev => [...prev, { id, msg, type }]);
                setTimeout(() => setToasts(prev => prev.filter(t => t.id !== id)), 4000);
            };

            const getPhantomProvider = () => {
                if ('phantom' in window && window.phantom.ethereum) return window.phantom.ethereum;
                if (window.ethereum && window.ethereum.isPhantom) return window.ethereum;
                return null;
            };

            useEffect(() => {
                const phantomProvider = getPhantomProvider();
                const anyProvider = phantomProvider || window.ethereum;

                if (anyProvider) {
                    setIsPhantomInstalled(!!phantomProvider);
                    const newProvider = new BrowserProvider(anyProvider);
                    setProvider(newProvider);
                    
                    anyProvider.request({ method: 'eth_accounts' })
                        .then(accounts => {
                            if (accounts.length > 0) handleAccountsChanged(accounts, newProvider);
                        });

                    anyProvider.on('accountsChanged', (accs) => handleAccountsChanged(accs, newProvider));
                    anyProvider.on('chainChanged', () => window.location.reload());
                } else {
                    addToast('Phantom Wallet not detected!', 'error');
                }
            }, []);

            const handleAccountsChanged = async (accounts, currentProvider) => {
                if (accounts.length === 0) {
                    setAccount('');
                    setRealBalance(0);
                    addToast('Terputus', 'info');
                } else {
                    setAccount(accounts[0]);
                    updateBalance(accounts[0], currentProvider);
                    addToast(`Terhubung: ${accounts[0].slice(0,6)}...`, 'success');
                    
                    const network = await currentProvider.getNetwork();
                    setNetworkName(Number(network.chainId) === 84532 ? 'Base Sepolia' : `Chain ID: ${network.chainId}`);
                }
            };

            const updateBalance = async (address, currentProvider) => {
                if (!currentProvider) return;
                try {
                    const bal = await currentProvider.getBalance(address);
                    setRealBalance(parseFloat(formatEther(bal)));
                } catch (e) { console.error("Balance err", e); }
            };

            const connectPhantom = async () => {
                const phantomProvider = getPhantomProvider();
                
                if (!phantomProvider) {
                    window.open('https://phantom.app/', '_blank');
                    addToast('Silakan instal Phantom Wallet!', 'error');
                    return;
                }
                
                try {
                    await phantomProvider.request({ method: 'eth_requestAccounts' });
                    
                    try {
                        await phantomProvider.request({
                            method: 'wallet_switchEthereumChain',
                            params: [{ chainId: BASE_NETWORK.chainId }],
                        });
                    } catch (switchError) {
                        if (switchError.code === 4902) {
                            try {
                                await phantomProvider.request({
                                    method: 'wallet_addEthereumChain',
                                    params: [BASE_NETWORK],
                                });
                            } catch (addError) {
                                addToast('Gagal menambahkan Network Base', 'error');
                            }
                        }
                    }
                } catch (error) {
                    addToast('Koneksi Ditolak', 'error');
                }
            };

            const handleFaucet = () => {
                if (!account) { connectPhantom(); return; }
                if (isFaucetLoading) return;
                setIsFaucetLoading(true);
                addToast('Mining 1 Mock ETH (Base)...', 'info');
                setTimeout(() => {
                    setMockBalance(prev => prev + 1);
                    setIsFaucetLoading(false);
                    addToast('üéÅ 1 ETH (Mock) ditambahkan!', 'success');
                }, 2000);
            };

            // --- ZERO FEE SWAP LOGIC (SIGNATURE BASED) ---
            const handleSwap = async () => {
                if (!account) { connectPhantom(); return; }
                if (!inputAmount) return;

                setIsSwapping(true);
                
                try {
                    const signer = await provider.getSigner();
                    
                    // Kita akan SELALU menggunakan mode signature (Gasless) untuk simulasi "Nol Biaya"
                    // karena user minta "Nol Biaya Fee"
                    addToast('Memproses Transaksi Bebas Gas (Base Mode)...', 'info');
                    
                    const message = `Zero Fee Swap on Base:\n\nSell: ${inputAmount} ${inputToken}\nBuy: ${outputAmount} ${outputToken}\nFee: 0 ETH\n\n(Signed for Gasless Execution)`;
                    
                    // Ini memicu popup di Phantom "Sign Message" - TIDAK PERLU ETH UNTUK GAS
                    await signer.signMessage(message);
                    
                    addToast('Tanda Tangan Sukses! Swap Berhasil.', 'success');
                    
                    // Update simulasi balance
                    if (inputToken === 'ETH') setMockBalance(prev => Math.max(0, prev - parseFloat(inputAmount)));
                    else setMockBalance(prev => prev + parseFloat(outputAmount));
                    
                    setInputAmount('');
                    setOutputAmount('');
                    
                } catch (error) {
                    console.error("Tx Error:", error);
                    addToast('Dibatalkan oleh User', 'error');
                } finally {
                    setIsSwapping(false);
                }
            };

            const fetchMarketData = async () => {
                try {
                    const response = await fetch(API_URL);
                    const data = await response.json();
                    if (data.pair) {
                        const pair = data.pair;
                        const currentPrice = parseFloat(pair.priceUsd);
                        if (prevPriceRef.current > 0) {
                            if (currentPrice > prevPriceRef.current) setPriceFlash('flash-green');
                            else if (currentPrice < prevPriceRef.current) setPriceFlash('flash-red');
                            setTimeout(() => setPriceFlash(''), 1000);
                        }
                        prevPriceRef.current = currentPrice;
                        setMarketData({
                            priceUsd: currentPrice, priceChange: pair.priceChange.h24, volume24h: pair.volume.h24,
                            marketCap: pair.fdv, pairName: `${pair.baseToken.symbol}/${pair.quoteToken.symbol}`, loading: false
                        });
                        if (chartData.length === 0) generateChartData(currentPrice, currentTimeFrame);
                        else lastChartPointRef.current = { time: 'LIVE', price: currentPrice };
                    }
                } catch (err) { console.error(err); }
            };

            const generateChartData = (price, tf) => {
                let points = 50; let volatility = 0.002; let intervalMinutes = 1;
                if (tf === '1H') { points = 60; volatility = 0.0005; intervalMinutes = 1; }
                else if (tf === '4H') { points = 48; volatility = 0.002; intervalMinutes = 5; }
                else if (tf === '1D') { points = 24; volatility = 0.01; intervalMinutes = 60; }
                let data = []; let currentP = price;
                for (let i = points; i > 0; i--) {
                    const change = (Math.random() - 0.5) * (price * volatility);
                    currentP = currentP - change;
                    const time = new Date(Date.now() - i * intervalMinutes * 60000);
                    data.push({ time: time.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }), price: currentP });
                }
                data.push({ time: 'LIVE', price: price });
                setChartData(data);
                lastChartPointRef.current = { time: 'LIVE', price: price };
            };

            useEffect(() => {
                fetchMarketData();
                const interval = setInterval(fetchMarketData, 10000);
                return () => clearInterval(interval);
            }, [currentTimeFrame]);

            useEffect(() => {
                const tick = setInterval(() => {
                    if (lastChartPointRef.current && chartData.length > 0) {
                        setChartData(prevData => {
                            const newData = [...prevData];
                            const lastPoint = newData[newData.length - 1];
                            const noise = (Math.random() - 0.5) * (marketData.priceUsd * 0.0002); 
                            newData[newData.length - 1] = { ...lastPoint, price: marketData.priceUsd + noise };
                            return newData;
                        });
                    }
                }, 1000);
                return () => clearInterval(tick);
            }, [marketData.priceUsd]);

            useEffect(() => {
                if (!inputAmount || !marketData.priceUsd) { setOutputAmount(''); return; }
                const val = parseFloat(inputAmount);
                if (isNaN(val)) return;
                const price = marketData.priceUsd;
                setOutputAmount(inputToken === 'ETH' ? (val * price).toFixed(2) : (val / price).toFixed(6));
            }, [inputAmount, inputToken, marketData.priceUsd]);

            const switchTokens = () => { setInputToken(outputToken); setOutputToken(inputToken); setInputAmount(outputAmount); };

            return (
                <div className="min-h-screen pb-6 flex flex-col font-sans relative bg-[#0b0e14]">
                    
                    {/* BANNER */}
                    <div className="bg-[#0052ff]/10 border-b border-[#0052ff]/30 text-[#0052ff] text-xs font-bold text-center py-1.5 flex justify-center items-center gap-2">
                        <IconActivity />
                        <span>BASE SEPOLIA MODE: Zero Gas Fee (Sponsored Transaction).</span>
                    </div>

                    {/* TOASTS */}
                    <div className="fixed top-20 right-4 z-[150] flex flex-col gap-2">
                        {toasts.map(toast => (
                            <div key={toast.id} className={`toast-enter bg-[#1a202e] border-l-4 ${toast.type === 'success' ? 'border-green-500' : 'border-red-500'} p-3 rounded shadow-lg flex items-center gap-3 min-w-[200px]`}>
                                {toast.type === 'success' ? <div className="w-2 h-2 bg-green-500 rounded-full"></div> : <div className="w-2 h-2 bg-red-500 rounded-full"></div>}
                                <span className="text-sm font-medium">{toast.msg}</span>
                            </div>
                        ))}
                    </div>

                    {/* NAVBAR */}
                    <nav className="border-b border-gray-800 bg-[#0b0e14]/95 backdrop-blur sticky top-0 z-50 px-4 h-16 flex items-center justify-between">
                        <div className="flex items-center gap-4">
                            <button className="md:hidden text-gray-400" onClick={()=>setIsMobileMenuOpen(!isMobileMenuOpen)}><IconMenu /></button>
                            <div className="flex items-center gap-2 text-[#0052ff]">
                                <IconActivity />
                                <span className="text-xl font-bold tracking-tight text-white">DexPro <span className="text-xs font-normal text-white bg-[#0052ff] px-1.5 py-0.5 rounded ml-1">BASE</span></span>
                            </div>
                        </div>

                        <div className="flex items-center gap-3">
                            {account && (
                                <div className="hidden sm:flex flex-col items-end text-xs mr-2">
                                    <span className="text-gray-400 flex items-center gap-1">
                                        {totalDisplayBalance} ETH
                                        <span className="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
                                    </span>
                                    <span className="font-bold text-gray-500">{networkName || 'Detecting...'}</span>
                                </div>
                            )}
                            <button onClick={account ? () => {} : connectPhantom} className={`flex items-center gap-2 px-3 sm:px-4 py-2 rounded-lg font-semibold text-xs sm:text-sm transition-all ${account ? 'bg-[#1a202e] text-[#0052ff] border border-[#0052ff]/30' : 'bg-[#0052ff] hover:bg-[#0042cc] text-white'}`}>
                                {!account && <IconPhantom />}
                                {account ? `${account.slice(0,6)}...${account.slice(-4)}` : 'Connect Phantom'}
                            </button>
                        </div>
                    </nav>

                    {/* MAIN CONTENT */}
                    <main className="flex-1 w-full max-w-[1600px] mx-auto p-3 sm:p-6 grid grid-cols-1 lg:grid-cols-12 gap-4 sm:gap-6 relative z-10">
                        {/* CHART */}
                        <div className="lg:col-span-8 flex flex-col gap-4">
                            <div className="bg-[#131a2a] p-4 rounded-xl border border-gray-800/60 flex flex-col sm:flex-row justify-between sm:items-end gap-4 shadow-lg">
                                <div className="flex items-center gap-3 sm:gap-4 z-10">
                                    <div className="relative shrink-0"><div className="w-8 h-8 rounded-full bg-slate-700 flex items-center justify-center border-2 border-[#131a2a] z-10 relative">üî∑</div><div className="w-8 h-8 rounded-full bg-blue-600 flex items-center justify-center border-2 border-[#131a2a] absolute top-0 left-5">üíµ</div></div>
                                    <div className="pl-6 sm:pl-8">
                                        <h1 className="text-lg font-bold flex items-center gap-2 text-gray-200">{marketData.pairName} <a href="#" className="text-gray-500 hover:text-blue-400"><IconExternalLink /></a></h1>
                                        <div className="flex items-center gap-2 mt-1">
                                            <span className={`text-2xl font-mono font-bold tracking-tight transition-colors duration-300 ${priceFlash}`}>${marketData.priceUsd.toLocaleString(undefined, { minimumFractionDigits: 2 })}</span>
                                            {!marketData.loading && <span className={`px-2 py-0.5 rounded text-xs font-bold bg-opacity-20 ${marketData.priceChange >= 0 ? 'bg-green-500/10 text-green-400' : 'bg-red-500/10 text-red-400'}`}>{marketData.priceChange >= 0 ? '+' : ''}{marketData.priceChange}%</span>}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div className="bg-[#131a2a] border border-gray-800 rounded-xl p-1 h-[450px] relative overflow-hidden flex flex-col justify-center items-center shadow-lg">
                                {chartData.length > 0 ? (
                                    <div className="flex-1 w-full mt-4">
                                        <ResponsiveContainer width="100%" height="100%">
                                            <AreaChart data={chartData}>
                                                <defs><linearGradient id="colorPrice" x1="0" y1="0" x2="0" y2="1"><stop offset="5%" stopColor="#0052ff" stopOpacity={0.3}/><stop offset="95%" stopColor="#0052ff" stopOpacity={0}/></linearGradient></defs>
                                                <CartesianGrid strokeDasharray="3 3" stroke="#1f2937" vertical={false} />
                                                <XAxis dataKey="time" hide />
                                                <YAxis domain={['auto', 'auto']} orientation="right" tick={{fill: '#9ca3af', fontSize: 11}} axisLine={false} tickLine={false} width={60} tickFormatter={(val) => `$${val.toFixed(0)}`} />
                                                <Tooltip contentStyle={{ backgroundColor: 'rgba(17, 24, 39, 0.9)', border: '1px solid #374151' }} itemStyle={{ color: '#fff' }} formatter={(val) => [`$${val.toFixed(2)}`, 'Price']} />
                                                <Area type="monotone" dataKey="price" stroke="#0052ff" strokeWidth={2} fill="url(#colorPrice)" isAnimationActive={false} />
                                            </AreaChart>
                                        </ResponsiveContainer>
                                    </div>
                                ) : <div className="w-12 h-12 border-4 border-[#0052ff] border-t-transparent rounded-full animate-spin"></div>}
                            </div>
                        </div>

                        {/* SWAP UI */}
                        <div className="lg:col-span-4">
                            <div className="bg-[#131a2a] border border-gray-800 rounded-2xl p-5 shadow-2xl lg:sticky lg:top-24">
                                <div className="flex justify-between items-center mb-5"><span className="font-bold text-white text-lg">Swap (Base)</span><div className="flex gap-3 text-gray-400"><IconRefresh /><IconSettings /></div></div>

                                {account && (
                                    <button 
                                        onClick={handleFaucet}
                                        disabled={isFaucetLoading}
                                        className="w-full mb-4 py-2 rounded-lg bg-green-500/20 text-green-400 border border-green-500/30 font-semibold text-sm hover:bg-green-500/30 transition-all flex items-center justify-center gap-2"
                                    >
                                        {isFaucetLoading ? <span className="animate-spin">‚è≥</span> : <IconGift />}
                                        {isFaucetLoading ? 'Menambang ETH...' : 'Klaim 1 ETH (Mock Reward)'}
                                    </button>
                                )}

                                <div className="bg-[#0b0e14] rounded-xl p-4 border border-gray-800">
                                    <div className="flex justify-between text-xs font-medium text-gray-400 mb-2"><span>Jual</span><span>Balance: {account ? totalDisplayBalance : '0'}</span></div>
                                    <div className="flex justify-between items-center gap-3">
                                        <input type="number" placeholder="0.0" value={inputAmount} onChange={(e) => setInputAmount(e.target.value)} className="bg-transparent text-3xl font-bold text-white outline-none w-full placeholder-gray-700" />
                                        <div className="flex items-center gap-2 bg-[#1f2937] px-3 py-1.5 rounded-full shrink-0 border border-gray-700 font-bold text-sm">{inputToken} <IconChevronDown /></div>
                                    </div>
                                </div>

                                <div className="relative h-4 z-10 my-[-10px]"><button onClick={switchTokens} className="absolute left-1/2 -translate-x-1/2 -translate-y-1/2 bg-[#131a2a] border-4 border-[#131a2a] p-2 rounded-xl text-gray-400 hover:text-[#0052ff] border-gray-800 shadow-lg"><IconArrowDownUp /></button></div>

                                <div className="bg-[#0b0e14] rounded-xl p-4 border border-gray-800 mt-2 mb-6">
                                    <div className="flex justify-between text-xs font-medium text-gray-400 mb-2"><span>Terima</span><span>Est. Output</span></div>
                                    <div className="flex justify-between items-center gap-3">
                                        <input type="text" placeholder="0.0" value={outputAmount} readOnly className="bg-transparent text-3xl font-bold text-white outline-none w-full cursor-default" />
                                        <div className="flex items-center gap-2 bg-[#1f2937] px-3 py-1.5 rounded-full shrink-0 border border-gray-700 font-bold text-sm">{outputToken} <IconChevronDown /></div>
                                    </div>
                                    <div className="text-xs font-medium text-gray-500 mt-2 flex justify-between">
                                        <span className="flex items-center gap-1 text-green-400"><IconBolt /> Fee: Rp 0 (Base Zero)</span>
                                        <span className="text-[#0052ff]/80">Base Sepolia</span>
                                    </div>
                                </div>

                                {account ? (
                                    <button 
                                        onClick={handleSwap}
                                        disabled={isSwapping || !inputAmount}
                                        className={`w-full py-4 rounded-xl font-bold text-lg transition-all shadow-xl active:scale-[0.98] ${
                                            isSwapping 
                                            ? 'bg-gray-700 text-gray-300 cursor-wait' 
                                            : !inputAmount 
                                                ? 'bg-[#1f2937] text-gray-500 cursor-not-allowed'
                                                : 'bg-[#0052ff] hover:bg-[#0042cc] text-white'
                                        }`}
                                    >
                                        {isSwapping ? 'Sign in Phantom...' : !inputAmount ? 'Masukkan Jumlah' : 'Swap (Zero Fee)'}
                                    </button>
                                ) : (
                                    <button 
                                        onClick={connectPhantom}
                                        className="w-full py-4 rounded-xl font-bold text-lg bg-[#0052ff] hover:bg-[#0042cc] text-white shadow-xl transition-all flex items-center justify-center gap-2"
                                    >
                                        <IconPhantom /> Connect Phantom (Base)
                                    </button>
                                )}
                                
                                <p className="text-[10px] text-gray-500 text-center mt-3">
                                    *Menggunakan protokol Gasless: Transaksi diproses melalui tanda tangan Off-chain (Gratis).
                                </p>
                            </div>
                        </div>
                    </main>
                </div>
            );
        }

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
