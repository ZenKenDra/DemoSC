<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DexPro - ZK Testnet (Real Web3)</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Babel untuk JSX Support -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body { background-color: #0b0e14; color: white; -webkit-tap-highlight-color: transparent; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Animasi Loading Awal */
        #root:empty::before {
            content: 'Initializing Web3 Provider...';
            display: flex;
            height: 100vh;
            justify-content: center;
            align-items: center;
            color: #6b7280;
            font-family: sans-serif;
            font-size: 0.875rem;
        }

        /* Modal Backdrop */
        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(4px);
        }

        /* Toast Animation */
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        .toast-enter { animation: slideIn 0.3s ease-out forwards; }
        
        /* Pulse Effect */
        .flash-green { color: #4ade80; transition: color 0.3s; }
        .flash-red { color: #f87171; transition: color 0.3s; }
    </style>

    <!-- IMPORT MAP: Menambahkan Ethers.js -->
    <script type="importmap">
    {
        "imports": {
            "react": "https://esm.sh/react@18.2.0",
            "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
            "react-dom": "https://esm.sh/react-dom@18.2.0",
            "recharts": "https://esm.sh/recharts@2.12.7?external=react,react-dom",
            "ethers": "https://esm.sh/ethers@6.11.1"
        }
    }
    </script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useRef } from 'react';
        import { createRoot } from 'react-dom/client';
        import { AreaChart, Area, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer } from 'recharts';
        import { ethers, BrowserProvider, parseEther, formatEther } from 'ethers';

        // --- KONFIGURASI NETWORK (ZK SYNC SEPOLIA TESTNET) ---
        // Kamu bisa ganti ini dengan jaringan ZK buatanmu sendiri
        const ZK_NETWORK = {
            chainId: '0x12c', // 300 dalam desimal
            chainName: 'zkSync Sepolia Testnet',
            nativeCurrency: {
                name: 'Ethereum',
                symbol: 'ETH',
                decimals: 18
            },
            rpcUrls: ['https://sepolia.era.zksync.dev'],
            blockExplorerUrls: ['https://sepolia.explorer.zksync.io/']
        };

        // --- ICONS ---
        const IconActivity = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>;
        const IconMenu = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg>;
        const IconSettings = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>;
        const IconArrowDownUp = () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m3 16 4 4 4-4"/><path d="M7 20V4"/><path d="m21 8-4-4-4 4"/><path d="M17 4v16"/></svg>;
        const IconChevronDown = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m6 9 6 6 6-6"/></svg>;
        const IconExternalLink = () => <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>;
        const IconRefresh = () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"/><path d="M16 21h5v-5"/></svg>;
        const IconX = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>;
        const IconCheck = () => <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>;
        const IconFox = () => <svg viewBox="0 0 32 32" width="24" height="24"><path fill="#E17726" d="M29.62 12.44L26.06 0l-1.66 4.67-4.83.62L16 1.13 12.42 5.3l-4.82-.62L5.94 0 2.38 12.44A5.57 5.57 0 0 0 0 17.13v3.29l9.31 9.9 6.69 1.67 6.69-1.67 9.31-9.9v-3.29a5.57 5.57 0 0 0-2.38-4.69zM7.22 19.46l-2.58-1.55 1.34-4.86 3.1 3.51-1.86 2.9zm6.05 4.38L10.5 21l-.73-3.69 3.5-1.92 3.73 1.92-.73 3.69-2.77 2.84zm7.51-4.38l-1.86-2.9 3.1-3.51 1.34 4.86-2.58 1.55z"/></svg>;
        const IconAlert = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>;

        // --- PAIR CONFIG (ETH/USDC) ---
        const PAIR_ADDRESS = '0x2287a9620adcbf6250dc71be9ee9b2d3a1ec85a464fc6f5c06669e8d07b61bba';
        const API_URL = `https://api.dexscreener.com/latest/dex/pairs/ethereum/${PAIR_ADDRESS}`;

        function App() {
            // State
            const [account, setAccount] = useState('');
            const [provider, setProvider] = useState(null);
            const [balance, setBalance] = useState('0');
            const [networkName, setNetworkName] = useState('');
            const [marketData, setMarketData] = useState({
                priceUsd: 0, priceChange: 0, volume24h: 0, marketCap: 0, pairName: 'ETH/USDC', loading: true
            });
            const [chartData, setChartData] = useState([]);
            const [currentTimeFrame, setCurrentTimeFrame] = useState('1H');
            const [inputToken, setInputToken] = useState('ETH');
            const [outputToken, setOutputToken] = useState('USDC');
            const [inputAmount, setInputAmount] = useState('');
            const [outputAmount, setOutputAmount] = useState('');
            const [priceFlash, setPriceFlash] = useState('');
            const [toasts, setToasts] = useState([]);
            const [isSwapping, setIsSwapping] = useState(false);
            const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);

            const prevPriceRef = useRef(0);
            const lastChartPointRef = useRef(null);

            // --- 1. TOAST SYSTEM ---
            const addToast = (msg, type = 'success') => {
                const id = Date.now();
                setToasts(prev => [...prev, { id, msg, type }]);
                setTimeout(() => setToasts(prev => prev.filter(t => t.id !== id)), 4000);
            };

            // --- 2. WEB3 CONNECTION LOGIC ---
            useEffect(() => {
                if (window.ethereum) {
                    const newProvider = new BrowserProvider(window.ethereum);
                    setProvider(newProvider);
                    
                    // Cek jika sudah connect sebelumnya
                    window.ethereum.request({ method: 'eth_accounts' })
                        .then(accounts => {
                            if (accounts.length > 0) handleAccountsChanged(accounts);
                        });

                    // Listeners
                    window.ethereum.on('accountsChanged', handleAccountsChanged);
                    window.ethereum.on('chainChanged', () => window.location.reload());
                }
            }, []);

            const handleAccountsChanged = async (accounts) => {
                if (accounts.length === 0) {
                    setAccount('');
                    setBalance('0');
                    addToast('Disconnected', 'info');
                } else {
                    setAccount(accounts[0]);
                    updateBalance(accounts[0]);
                    addToast(`Connected: ${accounts[0].slice(0,6)}...`, 'success');
                    
                    // Check Network
                    const network = await new BrowserProvider(window.ethereum).getNetwork();
                    setNetworkName(Number(network.chainId) === 300 ? 'ZK Sepolia' : 'Unknown Net');
                }
            };

            const updateBalance = async (address) => {
                if (!window.ethereum) return;
                const p = new BrowserProvider(window.ethereum);
                const bal = await p.getBalance(address);
                setBalance(parseFloat(formatEther(bal)).toFixed(4));
            };

            // --- 3. SWITCH/ADD NETWORK (ZK SYNC) ---
            const connectRealWallet = async () => {
                if (!window.ethereum) {
                    addToast('MetaMask not found!', 'error');
                    return;
                }
                
                try {
                    // 1. Request Account
                    await window.ethereum.request({ method: 'eth_requestAccounts' });
                    
                    // 2. Switch/Add Network to ZK Testnet
                    try {
                        await window.ethereum.request({
                            method: 'wallet_switchEthereumChain',
                            params: [{ chainId: ZK_NETWORK.chainId }],
                        });
                    } catch (switchError) {
                        // This error code means the chain has not been added to MetaMask.
                        if (switchError.code === 4902) {
                            try {
                                await window.ethereum.request({
                                    method: 'wallet_addEthereumChain',
                                    params: [ZK_NETWORK],
                                });
                            } catch (addError) {
                                console.error(addError);
                                addToast('Failed to add Network', 'error');
                            }
                        } else {
                            console.error(switchError);
                            addToast('Failed to switch Network', 'error');
                        }
                    }
                } catch (error) {
                    console.error(error);
                    addToast('Connection User Rejected', 'error');
                }
            };

            // --- 4. REAL TRANSACTION (SEND ETH DEMO) ---
            const handleSwap = async () => {
                if (!account) {
                    connectRealWallet();
                    return;
                }
                if (!inputAmount) return;

                setIsSwapping(true);
                addToast('Initiating transaction...', 'info');

                try {
                    const signer = await provider.getSigner();
                    
                    // DEMO: Karena kita tidak punya Smart Contract DEX yang terdeploy
                    // Kita akan kirim Transaksi ETH Self-Transfer (ke diri sendiri)
                    // Ini memicu MetaMask muncul, hitung gas asli, dan butuh sign user.
                    // Jika kamu punya contract router, ganti "to" dengan Router Address & "data" dengan function swap.
                    
                    const tx = await signer.sendTransaction({
                        to: account, // Kirim ke diri sendiri untuk demo
                        value: parseEther("0"), // Kirim 0 ETH (Hanya bayar gas) agar aman buat user test
                        // value: parseEther(inputAmount), // HATI-HATI: Jangan pakai ini kalau cuma testnet main-main
                    });

                    addToast('Transaction Pending...', 'info');
                    await tx.wait(); // Tunggu konfirmasi block
                    
                    addToast('Transaction Confirmed! âœ…', 'success');
                    updateBalance(account); // Refresh saldo
                    setInputAmount('');
                    setOutputAmount('');
                } catch (error) {
                    console.error("Tx Error:", error);
                    if(error.code === 4001) addToast('Transaction Rejected', 'error');
                    else addToast('Transaction Failed', 'error');
                } finally {
                    setIsSwapping(false);
                }
            };

            // --- 5. DATA FETCHING (DEXSCREENER) ---
            const fetchMarketData = async () => {
                try {
                    const response = await fetch(API_URL);
                    const data = await response.json();
                    if (data.pair) {
                        const pair = data.pair;
                        const currentPrice = parseFloat(pair.priceUsd);
                        if (prevPriceRef.current > 0) {
                            if (currentPrice > prevPriceRef.current) setPriceFlash('flash-green');
                            else if (currentPrice < prevPriceRef.current) setPriceFlash('flash-red');
                            setTimeout(() => setPriceFlash(''), 1000);
                        }
                        prevPriceRef.current = currentPrice;
                        setMarketData({
                            priceUsd: currentPrice, priceChange: pair.priceChange.h24, volume24h: pair.volume.h24,
                            marketCap: pair.fdv, pairName: `${pair.baseToken.symbol}/${pair.quoteToken.symbol}`, loading: false
                        });
                        if (chartData.length === 0) generateChartData(currentPrice, currentTimeFrame);
                        else lastChartPointRef.current = { time: 'LIVE', price: currentPrice };
                    }
                } catch (err) { console.error(err); }
            };

            const generateChartData = (price, tf) => {
                let points = 50; let volatility = 0.002; let intervalMinutes = 1;
                if (tf === '1H') { points = 60; volatility = 0.0005; intervalMinutes = 1; }
                else if (tf === '4H') { points = 48; volatility = 0.002; intervalMinutes = 5; }
                else if (tf === '1D') { points = 24; volatility = 0.01; intervalMinutes = 60; }
                let data = []; let currentP = price;
                for (let i = points; i > 0; i--) {
                    const change = (Math.random() - 0.5) * (price * volatility);
                    currentP = currentP - change;
                    const time = new Date(Date.now() - i * intervalMinutes * 60000);
                    data.push({ time: time.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }), price: currentP });
                }
                data.push({ time: 'LIVE', price: price });
                setChartData(data);
                lastChartPointRef.current = { time: 'LIVE', price: price };
            };

            useEffect(() => {
                fetchMarketData();
                const interval = setInterval(fetchMarketData, 10000);
                return () => clearInterval(interval);
            }, [currentTimeFrame]);

            useEffect(() => {
                const tick = setInterval(() => {
                    if (lastChartPointRef.current && chartData.length > 0) {
                        setChartData(prevData => {
                            const newData = [...prevData];
                            const lastPoint = newData[newData.length - 1];
                            const noise = (Math.random() - 0.5) * (marketData.priceUsd * 0.0002); 
                            newData[newData.length - 1] = { ...lastPoint, price: marketData.priceUsd + noise };
                            return newData;
                        });
                    }
                }, 1000);
                return () => clearInterval(tick);
            }, [marketData.priceUsd]);

            // Calculator
            useEffect(() => {
                if (!inputAmount || !marketData.priceUsd) { setOutputAmount(''); return; }
                const val = parseFloat(inputAmount);
                if (isNaN(val)) return;
                const price = marketData.priceUsd;
                setOutputAmount(inputToken === 'ETH' ? (val * price).toFixed(2) : (val / price).toFixed(6));
            }, [inputAmount, inputToken, marketData.priceUsd]);

            const switchTokens = () => {
                setInputToken(outputToken); setOutputToken(inputToken); setInputAmount(outputAmount);
            };

            const formatNum = (n) => {
                if (!n) return '0';
                if (n >= 1e9) return (n/1e9).toFixed(2)+'B'; 
                if (n >= 1e6) return (n/1e6).toFixed(2)+'M';
                return n.toFixed(2);
            };

            return (
                <div className="min-h-screen pb-6 flex flex-col font-sans relative bg-[#0b0e14]">
                    
                    {/* WEB3 BANNER */}
                    <div className="bg-indigo-600/20 border-b border-indigo-600/30 text-indigo-400 text-xs font-bold text-center py-1.5 flex justify-center items-center gap-2">
                        <IconActivity />
                        <span>WEB3 LIVE: Jaringan ZK Sync Sepolia Testnet Aktif. Gunakan Faucet untuk ETH.</span>
                    </div>

                    {/* TOASTS */}
                    <div className="fixed top-20 right-4 z-[150] flex flex-col gap-2">
                        {toasts.map(toast => (
                            <div key={toast.id} className={`toast-enter bg-[#1a202e] border-l-4 ${toast.type === 'success' ? 'border-green-500' : toast.type === 'error' ? 'border-red-500' : 'border-blue-500'} p-3 rounded shadow-lg flex items-center gap-3 min-w-[200px]`}>
                                {toast.type === 'success' ? <div className="w-2 h-2 bg-green-500 rounded-full"></div> : toast.type === 'error' ? <div className="w-2 h-2 bg-red-500 rounded-full"></div> : <div className="w-2 h-2 bg-blue-500 rounded-full"></div>}
                                <span className="text-sm font-medium">{toast.msg}</span>
                            </div>
                        ))}
                    </div>

                    {/* NAVBAR */}
                    <nav className="border-b border-gray-800 bg-[#0b0e14]/95 backdrop-blur sticky top-0 z-50 px-4 h-16 flex items-center justify-between">
                        <div className="flex items-center gap-4">
                            <button className="md:hidden text-gray-400" onClick={()=>setIsMobileMenuOpen(!isMobileMenuOpen)}><IconMenu /></button>
                            <div className="flex items-center gap-2 text-blue-500">
                                <IconActivity />
                                <span className="text-xl font-bold tracking-tight text-white">DexPro <span className="text-xs font-normal text-gray-400 bg-gray-800 px-1.5 py-0.5 rounded ml-1 border border-gray-700">ZK-WEB3</span></span>
                            </div>
                            <div className="hidden md:flex gap-1 bg-gray-900/50 p-1 rounded-lg border border-gray-800 ml-4">
                                {['Swap', 'Limit', 'DCA'].map(item => (
                                    <button key={item} className={`px-4 py-1.5 text-sm font-medium rounded-md transition-all ${item === 'Swap' ? 'bg-gray-800 text-white' : 'text-gray-400 hover:text-white'}`}>{item}</button>
                                ))}
                            </div>
                        </div>

                        <div className="flex items-center gap-3">
                            {account && (
                                <div className="hidden sm:flex flex-col items-end text-xs mr-2">
                                    <span className="text-gray-400 flex items-center gap-1">
                                        {balance} ETH
                                        <span className="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
                                    </span>
                                    <span className="font-bold text-gray-500">{networkName || 'Detecting...'}</span>
                                </div>
                            )}
                            <button onClick={account ? () => {} : connectRealWallet} className={`flex items-center gap-2 px-3 sm:px-4 py-2 rounded-lg font-semibold text-xs sm:text-sm transition-all ${account ? 'bg-[#1a202e] text-green-400 border border-green-900/30' : 'bg-orange-600 hover:bg-orange-500 text-white'}`}>
                                {!account && <IconFox />}
                                {account ? `${account.slice(0,6)}...${account.slice(-4)}` : 'Connect MetaMask'}
                            </button>
                        </div>
                    </nav>

                    {/* MAIN CONTENT */}
                    <main className="flex-1 w-full max-w-[1600px] mx-auto p-3 sm:p-6 grid grid-cols-1 lg:grid-cols-12 gap-4 sm:gap-6 relative z-10">
                        {/* LEFT: CHART */}
                        <div className="lg:col-span-8 flex flex-col gap-4">
                            <div className="bg-[#131a2a] p-4 rounded-xl border border-gray-800/60 flex flex-col sm:flex-row justify-between sm:items-end gap-4 shadow-lg relative overflow-hidden">
                                <div className="flex items-center gap-3 sm:gap-4 z-10">
                                    <div className="relative shrink-0"><div className="w-8 h-8 rounded-full bg-slate-700 flex items-center justify-center border-2 border-[#131a2a] z-10 relative">ðŸ”·</div><div className="w-8 h-8 rounded-full bg-blue-600 flex items-center justify-center border-2 border-[#131a2a] absolute top-0 left-5">ðŸ’µ</div></div>
                                    <div className="pl-6 sm:pl-8">
                                        <h1 className="text-lg font-bold flex items-center gap-2 text-gray-200">{marketData.pairName} <a href="#" className="text-gray-500 hover:text-blue-400"><IconExternalLink /></a></h1>
                                        <div className="flex items-center gap-2 mt-1">
                                            <span className={`text-2xl font-mono font-bold tracking-tight transition-colors duration-300 ${priceFlash}`}>${marketData.priceUsd.toLocaleString(undefined, { minimumFractionDigits: 2 })}</span>
                                            {!marketData.loading && <span className={`px-2 py-0.5 rounded text-xs font-bold bg-opacity-20 ${marketData.priceChange >= 0 ? 'bg-green-500/10 text-green-400' : 'bg-red-500/10 text-red-400'}`}>{marketData.priceChange >= 0 ? '+' : ''}{marketData.priceChange}%</span>}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div className="bg-[#131a2a] border border-gray-800 rounded-xl p-1 h-[450px] relative overflow-hidden flex flex-col justify-center items-center shadow-lg">
                                {chartData.length > 0 ? (
                                    <div className="flex-1 w-full mt-4">
                                        <ResponsiveContainer width="100%" height="100%">
                                            <AreaChart data={chartData}>
                                                <defs><linearGradient id="colorPrice" x1="0" y1="0" x2="0" y2="1"><stop offset="5%" stopColor="#3b82f6" stopOpacity={0.3}/><stop offset="95%" stopColor="#3b82f6" stopOpacity={0}/></linearGradient></defs>
                                                <CartesianGrid strokeDasharray="3 3" stroke="#1f2937" vertical={false} />
                                                <XAxis dataKey="time" hide />
                                                <YAxis domain={['auto', 'auto']} orientation="right" tick={{fill: '#9ca3af', fontSize: 11}} axisLine={false} tickLine={false} width={60} tickFormatter={(val) => `$${val.toFixed(0)}`} />
                                                <Tooltip contentStyle={{ backgroundColor: 'rgba(17, 24, 39, 0.9)', border: '1px solid #374151' }} itemStyle={{ color: '#fff' }} formatter={(val) => [`$${val.toFixed(2)}`, 'Price']} />
                                                <Area type="monotone" dataKey="price" stroke="#3b82f6" strokeWidth={2} fill="url(#colorPrice)" isAnimationActive={false} />
                                            </AreaChart>
                                        </ResponsiveContainer>
                                    </div>
                                ) : <div className="w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"></div>}
                            </div>
                        </div>

                        {/* RIGHT: REAL SWAP INTERFACE */}
                        <div className="lg:col-span-4">
                            <div className="bg-[#131a2a] border border-gray-800 rounded-2xl p-5 shadow-2xl lg:sticky lg:top-24">
                                <div className="flex justify-between items-center mb-5"><span className="font-bold text-white text-lg">Swap (On-Chain)</span><div className="flex gap-3 text-gray-400"><IconRefresh /><IconSettings /></div></div>

                                <div className="bg-[#0b0e14] rounded-xl p-4 border border-gray-800">
                                    <div className="flex justify-between text-xs font-medium text-gray-400 mb-2"><span>Jual</span><span>Balance: {account ? balance : '0'}</span></div>
                                    <div className="flex justify-between items-center gap-3">
                                        <input type="number" placeholder="0.0" value={inputAmount} onChange={(e) => setInputAmount(e.target.value)} className="bg-transparent text-3xl font-bold text-white outline-none w-full placeholder-gray-700" />
                                        <div className="flex items-center gap-2 bg-[#1f2937] px-3 py-1.5 rounded-full shrink-0 border border-gray-700 font-bold text-sm">{inputToken} <IconChevronDown /></div>
                                    </div>
                                </div>

                                <div className="relative h-4 z-10 my-[-10px]"><button onClick={switchTokens} className="absolute left-1/2 -translate-x-1/2 -translate-y-1/2 bg-[#131a2a] border-4 border-[#131a2a] p-2 rounded-xl text-gray-400 hover:text-blue-400 border-gray-800 shadow-lg"><IconArrowDownUp /></button></div>

                                <div className="bg-[#0b0e14] rounded-xl p-4 border border-gray-800 mt-2 mb-6">
                                    <div className="flex justify-between text-xs font-medium text-gray-400 mb-2"><span>Terima</span><span>Est. Output</span></div>
                                    <div className="flex justify-between items-center gap-3">
                                        <input type="text" placeholder="0.0" value={outputAmount} readOnly className="bg-transparent text-3xl font-bold text-white outline-none w-full cursor-default" />
                                        <div className="flex items-center gap-2 bg-[#1f2937] px-3 py-1.5 rounded-full shrink-0 border border-gray-700 font-bold text-sm">{outputToken} <IconChevronDown /></div>
                                    </div>
                                    <div className="text-xs font-medium text-gray-500 mt-2 flex justify-between">
                                        <span>Fee: Gas + 0% LP</span>
                                        <span className="text-green-500/80">ZK Sepolia</span>
                                    </div>
                                </div>

                                {account ? (
                                    <button 
                                        onClick={handleSwap}
                                        disabled={isSwapping || !inputAmount}
                                        className={`w-full py-4 rounded-xl font-bold text-lg transition-all shadow-xl active:scale-[0.98] ${
                                            isSwapping 
                                            ? 'bg-gray-700 text-gray-300 cursor-wait' 
                                            : !inputAmount 
                                                ? 'bg-[#1f2937] text-gray-500 cursor-not-allowed'
                                                : 'bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-500 hover:to-indigo-500 text-white'
                                        }`}
                                    >
                                        {isSwapping ? 'Confirm in MetaMask...' : !inputAmount ? 'Enter Amount' : 'Swap Now'}
                                    </button>
                                ) : (
                                    <button 
                                        onClick={connectRealWallet}
                                        className="w-full py-4 rounded-xl font-bold text-lg bg-orange-600 hover:bg-orange-500 text-white shadow-xl transition-all"
                                    >
                                        Connect MetaMask (ZK Testnet)
                                    </button>
                                )}
                                
                                <p className="text-[10px] text-gray-500 text-center mt-3">
                                    *Note: Transaksi ini adalah simulasi transfer 0 ETH untuk memicu gas fee asli di jaringan ZK Sync Sepolia. Tidak ada Smart Contract yang dipanggil untuk keamanan demo.
                                </p>
                            </div>
                        </div>
                    </main>
                </div>
            );
        }

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
